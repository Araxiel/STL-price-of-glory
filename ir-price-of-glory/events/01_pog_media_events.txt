###############################
# Price Of Glory Events
# by Araxiel
###############################

##### Media Events
namespace = pog_media_event

# pog_media_event.1		- State Media - subversive media initiator - hidden event
planet_event = {
	id = pog_media_event.1

	hide_window = yes

	mean_time_to_happen = {
		years = 65
		modifier = {
			factor = 0.5
			OWNER = {
				has_policy_flag = "regulation_state_media"
			}
		}
	}

	trigger = {
		has_owner = yes
		years_passed > 10
		OWNER = {
			count_owned_pops = {
				limit = {	is_enslaved = no }
				count > 15
			}
			OR = {
				has_policy_flag = "regulation_state_media"
				has_policy_flag = "regulation_controlled_media"
			}
		}
		count_owned_pops = {
			limit = {	is_enslaved = no }
			count > 3
		}
		NOT = { has_planet_flag = recent_subversive_media }
		is_capital = no
	}

	after = {
	}

	immediate = {
		save_event_target_as = subversive_media_planet
		random_list = {
			## not found
			30 = {
				planet_event = { id = pog_media_event.2 days = 10 random = 10 }
			}
			## being found
			60 = {
				planet_event = { id = pog_media_event.3 days = 10 random = 10 }
			}
		}
		set_timed_planet_flag = {
			flag = recent_subversive_media
			days = 720
		}
	}
}

# pog_media_event.2		- State Media - subversive media not intercepted
planet_event = {
	id = pog_media_event.2
	title = pog_media_event.2.title
	desc = "pog_media_event.2.desc"
	location = ROOT

	picture = GFX_evt_smugglers_in_bar
	show_sound = event_factions

	is_triggered_only = yes

	trigger = {
	}

	after = {
	}

	immediate = {
		add_modifier = {
			modifier = subversive_media
			days = 2000 # 5.4 years / 66 months
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = subversive_media
				days = 2000 # 5.4 years / 66 months
			}
		}
	}
}

# pog_media_event.3		- State Media - subversive media intercepted
planet_event = {
	id = pog_media_event.3
	title = pog_media_event.3.title
	desc = "pog_media_event.3.desc"
	picture = GFX_evt_cyberpunk_cops
	show_sound = event_combine_chatter

	location = ROOT

	is_triggered_only = yes

	trigger = {
	}

	after = {
	}

	immediate = {
	}

	# raid
	option = {
		name = pog_media_event.3.a
		add_modifier = {
			modifier = raided_political_opponents
			days = 2000 # 5.4 years
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				unrest < 50
			}
			modifier = {
				factor = 3
				OWNER = {
					OR = {
						has_ethic = ethic_fanatic_militarist
						has_ethic = ethic_fanatic_spiritualist
						has_ethic = ethic_fanatic_xenophobe
					}
				}
			}
			modifier = {
				factor = 2
				OWNER = {
					has_ethic = ethic_fanatic_authoritarian
				}
			}
		}
	}

	# no-raid
	option = {
		name = pog_media_event.3.b
		add_modifier = {
			modifier = subversive_media
			days = 2000 # 5.4 years
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				unrest > 50
			}
			modifier = {
				factor = 2
				OWNER = {
					OR = {
						has_ethic = ethic_egalitarian
						has_ethic = ethic_xenophile
						has_ethic = ethic_fanatic_xenophile
					}
				}
			}
		}
	}
}


# pog_media_event.10		-	Decennial Miitary Parade Pulse (HIDDEN)
event = {
	id = pog_media_event.10
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_playable_country = {
			limit = {
				OR = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
				}
			}
			country_event = { id = pog_media_event.11 days = 90 random = 60 }
		}
	}
}

# pog_media_event.11		- Miitary Parade Started
country_event = {
	id = pog_media_event.11
	title = pog_media_event.11.title
	desc = "pog_media_event.11.desc"
	picture = GFX_evt_authoritarian
	show_sound = event_FEDNET_sting

	location = ROOT

	is_triggered_only = yes

	trigger = {
	}

	after = {
	}

	immediate = {
	}

	# no celebration
	option = {
		name = pog_media_event.11.a

		set_timed_flag = {
			flag = no_military_parade_held
			days = 720
		}
		country_event = { id = pog_media_event.15 days = 30 random = 10 }

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				has_ethic = ethic_authoritarian
				has_ethic = ethic_fanatic_authoritarian
			}
		}
	}

	# celebrate
	option = {
		name = pog_media_event.11.b

		capital_scope = {
			save_event_target_as = parade_location
			if = {
				limit = {
					root = {
						fleet_power > 7999
						fleet_power < 20000
					}
				}
				enable_special_project = {
					name = "FLEET_PARADE_1_PROJECT"
					location = event_target:parade_location
					owner = root
				}
				break = yes
			}
			if = {
				limit = {
					root = {
						fleet_power > 19999
						fleet_power < 50000
					}
				}
				enable_special_project = {
					name = "FLEET_PARADE_2_PROJECT"
					location = event_target:parade_location
					owner = root
				}
				break = yes
			}
			if = {
				limit = {
					root = { fleet_power > 49999 }
				}
				enable_special_project = {
					name = "FLEET_PARADE_3_PROJECT"
					location = event_target:parade_location
					owner = root
				}
				break = yes
			}
		}

		ai_chance = {
			factor = 200
			modifier = {
				factor = 5
				has_ethic = ethic_fanatic_militarist
			}
		}
	}

	# grand-celebration
	option = {
		name = pog_media_event.11.c

		allow = {
			minerals > 2999
			energy > 5999
			food > 99
		}

		add_minerals = -3000
		add_energy = -6000
		add_food = -100

		capital_scope = {
			save_event_target_as = parade_location
			if = {
				limit = {
					root = {
						fleet_power > 7999
						fleet_power < 20000
					}
				}
				enable_special_project = {
					name = "FLEET_PARADE_1_PROJECT"
					location = event_target:parade_location
					owner = root
				}
				break = yes
			}
			if = {
				limit = {
					root = {
						fleet_power > 19999
						fleet_power < 50000
					}
				}
				enable_special_project = {
					name = "FLEET_PARADE_2_PROJECT"
					location = event_target:parade_location
					owner = root
				}
				break = yes
			}
			if = {
				limit = {
					root = { fleet_power > 49999 }
				}
				enable_special_project = {
					name = "FLEET_PARADE_3_PROJECT"
					location = event_target:parade_location
					owner = root
				}
				break = yes
			}
		}

		ai_chance = {
			factor = 100
			modifier = {
				factor = 8
				has_ethic = ethic_fanatic_militarist
				OR = {
					has_ethic = ethic_authoritarian
					has_ethic = ethic_fanatic_authoritarian
				}
			}
		}
	}
}

# pog_media_event.12		- Parade Halfway Completed (HIDDEN)
ship_event = {
	id = pog_media_event.12
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		owner = {
			any_owned_fleet = {
				exists = orbit
				exists = leader
				orbit = { is_same_value = event_target:parade_location }
			}
		}
	}

	immediate = {
		owner = {
			random_owned_fleet = {
				limit = {
					exists = orbit
					exists = leader
					orbit = { is_same_value = event_target:parade_location }
				}
				leader = { save_event_target_as = parade_admiral }
				save_event_target_as = parade_fleet
			}
			random_list = {
				## Everything's fine
				80 = {
				}
				## Accident
				10 = {
					country_event = { id = pog_media_event.102 }
				}
				## Insurgent incident
				10 = {
					country_event = { id = pog_media_event.103 }
				}
			}
		}
	}
}

# pog_media_event.13 	- Parade Success
country_event = {
	id = pog_media_event.13
	title = "pog_media_event.13.name"
	desc = "pog_media_event.13.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_sensor_ping

	is_triggered_only = yes

	option = {
		name = "pog_media_event.13.a"
		add_modifier = {
			modifier = "fleet_maneuvers_recruitment"
			days = 1800
		}
	}
}

# pog_media_event.14 	- Parade Failed
country_event = {
	id = pog_media_event.14
	title = "pog_media_event.14.name"
	desc = "pog_media_event.14.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_sensor_ping

	is_triggered_only = yes

	option = {
		name = "pog_media_event.14.a"
		add_modifier = {
			modifier = "fleet_maneuvers_recruitment"
			days = 1800
		}
	}
}

# pog_media_event.15 	- No Parade
country_event = {
	id = pog_media_event.15
	title = "pog_media_event.15.name"
	picture = GFX_evt_unknown_ships
	show_sound = event_sensor_ping

	is_triggered_only = yes

	# different text based on ethics
	desc = {
		trigger = {
			text = pog_media_event.15.desc.start
			success_text = {
				text = pog_media_event.15.desc.fanatic_militarist
				has_ethic = ethic_fanatic_militarist
			}
			success_text = {
				text = pog_media_event.15.desc.fanatic_authoritarian
				AND = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_authoritarian
				}
			}
		}
	}

	option = {
		name = "pog_media_event.15.a"

		# if parade is important, the penalty will last longer (in addition to other problems)
		if = {
			limit = {
				OR = {
					has_ethic = ethic_fanatic_militarist
					AND = {
						has_ethic = ethic_militarist
						has_ethic = ethic_fanatic_authoritarian
					}
				}
			}
			add_modifier = {
				modifier = "no_military_parade_held"
				days = 2200 	#6 years
			}
			else = {
				add_modifier = {
					modifier = "no_military_parade_held"
					days = 1100 	#3 years
				}
			}
		}
	}
}
